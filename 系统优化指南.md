# 系统优化指南 - 针对集成显卡+16GB内存

基于你的系统配置（AMD Radeon 760M + 16GB内存），以下是专门的优化建议。

## 🖥️ 你的系统分析

### 当前配置
- **内存**: 15.2GB (当前使用74% = 11.2GB)
- **显卡**: AMD Radeon 760M 集成显卡
- **GPU内存**: 1.2/8.0GB 共享内存架构
- **CPU**: 4.55GHz (当前44%使用率)

### 性能瓶颈识别
1. **内存压力**: 74%使用率已接近上限
2. **集成显卡**: 共享系统内存，GPU加速效果有限
3. **内存竞争**: Whisper模型+系统进程+其他应用

## 🎯 针对性优化方案

### 1. 立即优化（推荐）

#### 使用优化版脚本
```bash
# 推荐配置 - 平衡性能和质量
python audio_to_srt_optimized.py "你的音频文件.mp4" -l en --compute-type int8 -m base --cpu-threads 4
```

#### 关键优化参数
- **计算类型**: `int8` (减少50-70%内存使用)
- **模型选择**: `base` (你的16GB内存的最佳平衡点)
- **CPU线程**: `4` (避免过载)
- **设备**: `cpu` (集成显卡不建议GPU加速)

### 2. 三种配置对比

#### 📈 配置A: 性能优先 (推荐)
```python
converter = OptimizedAudioToSRT(
    model_size="base",      # 74MB模型
    compute_type="int8",    # 8位整数，大幅减少内存
    cpu_threads=4,          # 适中的并行度
    device="cpu"            # CPU计算
)
```
**预期效果**: 内存使用↓40%, 速度适中, 质量良好

#### ⚡ 配置B: 速度优先
```python
converter = OptimizedAudioToSRT(
    model_size="tiny",      # 39MB小模型
    compute_type="int8",    # 最小内存使用
    cpu_threads=2,          # 低并行度
    device="cpu"
)
```
**预期效果**: 内存使用↓60%, 速度最快, 质量基础

#### 🎯 配置C: 质量优先（谨慎使用）
```python
converter = OptimizedAudioToSRT(
    model_size="small",     # 244MB模型
    compute_type="int8",    # 必须用int8节省内存
    cpu_threads=4,          # 最大并行度
    device="cpu"
)
```
**预期效果**: 内存使用↓20%, 速度较慢, 质量最好

### 3. 系统级优化

#### 处理前准备
```bash
# 1. 关闭不必要的应用程序
# 2. 清理系统缓存
# 3. 确保有足够磁盘空间（至少5GB）

# 4. 监控系统资源
python quick_test_optimized.py
```

#### 环境变量优化
```bash
# 限制线程数减少内存竞争
set OMP_NUM_THREADS=4
set MKL_NUM_THREADS=4

# 运行优化版本
python audio_to_srt_optimized.py "你的文件.mp4" -l en --auto-config
```

## 🚀 实际使用建议

### 步骤1: 快速测试
```bash
# 运行系统配置检测
python quick_test_optimized.py
```

### 步骤2: 选择最佳配置
根据测试结果选择：
- **内存 < 80%**: 使用base模型 + int8
- **内存 > 85%**: 使用tiny模型 + int8  
- **追求质量**: 使用small模型 + int8

### 步骤3: 批量处理优化
```bash
# 单文件处理（推荐）
python audio_to_srt_optimized.py "input.mp4" -l en -m base --compute-type int8

# 如果内存不足，降级为tiny
python audio_to_srt_optimized.py "input.mp4" -l en -m tiny --compute-type int8
```

## 📊 性能对比参考

| 配置 | 模型大小 | 内存使用 | 处理速度 | 质量 | 推荐场景 |
|------|----------|----------|----------|------|----------|
| **推荐** | base+int8 | ~2-3GB | 中等 | 良好 | **日常使用** |
| 快速 | tiny+int8 | ~1-2GB | 最快 | 基础 | 快速预览 |
| 质量 | small+int8 | ~4-5GB | 较慢 | 最好 | 重要内容 |
| 原版 | small+float32 | ~8-10GB | 慢 | 最好 | ❌内存不足 |

## ⚠️ 注意事项

### 内存管理
1. **监控使用率**: 超过85%时立即降级配置
2. **及时清理**: 处理完成后重启脚本释放内存
3. **避免多任务**: 不要同时运行多个转录任务

### 质量控制
1. **语言参数**: 明确指定`-l en`避免语言混淆
2. **提示词**: 添加技术相关提示词提升准确度
3. **质量检查**: 在视频播放器中测试字幕效果

### 故障排除
```bash
# 如果出现内存不足错误
python audio_to_srt_optimized.py "input.mp4" -l en -m tiny --compute-type int8 --cpu-threads 2

# 如果模型加载失败
# 1. 检查网络连接
# 2. 清理.cache/huggingface目录
# 3. 重新下载模型
```

## 🎉 完整工作流程

### 最佳实践流程
```bash
# 1. 系统检测和配置推荐
python quick_test_optimized.py

# 2. 音频转字幕（优化版）
python audio_to_srt_optimized.py "你的视频.mp4" -l en -m base --compute-type int8

# 3. 质量检查
# 在视频播放器中测试字幕效果
```

### 预期性能提升
- **内存使用**: 减少40-60%
- **处理稳定性**: 避免内存溢出
- **系统响应**: 保持其他应用正常运行
- **质量保证**: 接近原版效果

## 💡 进阶优化

### 长视频处理
对于超过1小时的视频：
1. 分段处理：每30分钟分割一次
2. 使用tiny模型快速预览
3. 确认质量后再用base模型精细处理

### 批量处理策略
```bash
# 逐个处理，避免内存累积
for file in *.mp4; do
    python audio_to_srt_optimized.py "$file" -l en -m base --compute-type int8
    # 处理完成后暂停，让系统释放内存
    sleep 10
done
```

---

## 🎯 立即开始

**现在就试试优化版本**：
```bash
python quick_test_optimized.py
```

这将帮你找到最适合你系统的配置，显著改善处理性能！ 
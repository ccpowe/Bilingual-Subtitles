# 音频转SRT字幕完整解决方案

一个基于Whisper模型的音频转字幕工具，支持多种音频格式，并提供智能字幕优化功能。

## 🎯 功能特色

- **高质量转录**: 基于OpenAI Whisper模型，支持多种语言
- **多格式支持**: 支持MP3、MP4、WAV、FLAC、M4A、MKV、AVI等格式
- **智能优化**: 自动优化字幕分割，提升观看体验  
- **双语支持**: 生成双语字幕模板，便于翻译
- **批量处理**: 支持批量转换多个音频文件
- **命令行界面**: 简单易用的命令行工具

## 📦 依赖安装

### 1. Python环境要求
- Python 3.8+
- 推荐使用虚拟环境

### 2. 安装依赖包
```bash
# 安装核心依赖
pip install faster-whisper soundfile

# 可选：如果需要处理更多音频格式
pip install ffmpeg-python
```

### 3. 系统依赖（可选）
如果遇到音频格式问题，可能需要安装FFmpeg：
- **Windows**: 下载FFmpeg并添加到PATH
- **Linux**: `sudo apt install ffmpeg`
- **macOS**: `brew install ffmpeg`

## 🚀 快速开始

### 1. 单文件转换
```bash
# 基本用法
python audio_to_srt.py your_video.mp4

# 指定语言和模型
python audio_to_srt.py your_video.mp4 -l zh -m base

# 指定输出文件
python audio_to_srt.py input.mp4 -o output.srt
```

### 2. 批量转换
```bash
# 批量处理目录
python audio_to_srt.py audio_folder --batch

# 指定输出目录
python audio_to_srt.py audio_folder --batch -o srt_folder
```

### 3. 优化配置转换
```bash
# 使用优化配置生成高质量SRT
python audio_to_srt_optimized.py your_video.mp4 -l en --auto-config
```

## ⚙️ 参数说明

### 模型选择 (`-m`, `--model`)
| 模型 | 大小 | 速度 | 质量 | 推荐用途 |
|------|------|------|------|----------|
| tiny | 39MB | 最快 | 基础 | 快速测试 |
| base | 74MB | 快 | 良好 | **推荐默认** |
| small | 244MB | 中等 | 较好 | 平衡性能 |
| medium | 769MB | 慢 | 好 | 高质量需求 |
| large-v3 | 1550MB | 最慢 | 最好 | 专业用途 |

### 语言设置 (`-l`, `--language`)
- `zh`: 中文
- `en`: 英文
- `ja`: 日语
- `ko`: 韩语
- 更多语言代码请参考ISO 639-1标准

### 设备选择 (`-d`, `--device`)
- `cpu`: CPU计算（默认）
- `cuda`: GPU加速（需要NVIDIA GPU和CUDA）

## 💻 Python API使用

### 基本使用
```python
from audio_to_srt import AudioToSRT

# 创建转换器
converter = AudioToSRT(
    model_size="base",
    device="cpu",
    compute_type="float32"
)

# 加载模型
converter.load_model()

# 转换音频
result = converter.transcribe_to_srt(
    audio_file="your_video.mp4",
    language="zh",
    initial_prompt="这是一个技术讲座的录音："
)

print(f"字幕文件已生成: {result}")
```

### 批量处理
```python
# 批量转换目录中的所有音频文件
converter.batch_convert(
    input_dir="audio_files",
    output_dir="srt_files", 
    language="zh"
)
```

## 🔧 性能优化

针对不同硬件配置，提供了优化版本以改善处理性能：

### 配置对比
**基础配置**：
```bash
python audio_to_srt.py input.mp4 -l en -m small
# 内存使用: ~8-10GB, 质量最好
```

**优化配置**：
```bash
python audio_to_srt_optimized.py input.mp4 -l en -m base --compute-type int8
# 内存使用: ~2-3GB, 质量良好, 兼容性好
```

### 自动配置
```bash
# 系统自动推荐最佳配置
python audio_to_srt_optimized.py input.mp4 -l en --auto-config
```

## 📁 项目文件结构

```
cut/srt_translate/
├── audio_to_srt.py                    # 基础转换脚本
├── audio_to_srt_optimized.py          # 优化版转换脚本 
├── audio_to_srt_example.py            # 使用示例
├── quick_test_optimized.py            # 快速配置测试
├── 系统优化指南.md                     # 系统优化指南
├── 音频转字幕使用指南.md               # 本文档
└── str_file/                          # 字幕文件目录
    └── *.srt                          # 生成的字幕文件
```

## 🔥 完整工作流程

### 1. 系统配置检测
```bash
# 检测最佳配置
python quick_test_optimized.py
```

### 2. 音频转字幕（优化版）
```bash
# 生成高质量字幕
python audio_to_srt_optimized.py lecture.mp4 -l en --auto-config
# 输出：lecture.srt
```

### 3. 质量检查
1. 在视频播放器中加载字幕文件
2. 检查字幕与音频同步效果
3. 验证转录准确性

## 🎯 使用技巧

### 1. 模型选择建议
- **快速测试**: 使用`tiny`模型
- **一般用途**: 使用`base`模型（推荐）
- **高质量**: 使用`small`或`medium`模型
- **专业用途**: 使用`large-v3`模型

### 2. 提示词优化
根据音频内容添加合适的提示词：
```python
# 技术讲座
initial_prompt="这是一个关于编程技术的讲座录音："

# 会议记录
initial_prompt="这是一个商务会议的录音："

# 采访内容
initial_prompt="这是一个人物访谈的录音："
```

### 3. 性能优化
- 使用GPU加速（如果可用）：`-d cuda`
- 根据硬件选择合适的模型大小
- 批量处理时考虑内存使用

### 4. 质量控制
- 检查语言检测结果
- 对比不同模型的输出质量
- 使用SRT优化器改善分割效果

## ❗ 常见问题

### Q1: 模型加载失败
**症状**: `模型加载失败`错误
**解决**: 
- 检查网络连接（首次使用会下载模型）
- 确保有足够磁盘空间
- 尝试使用更小的模型

### Q2: 音频格式不支持
**症状**: `文件格式错误`
**解决**:
- 安装FFmpeg
- 使用支持的格式（MP3、MP4、WAV等）
- 转换音频格式后再处理

### Q3: 转录质量差
**症状**: 转录文本错误率高
**解决**:
- 使用更大的模型
- 确保音频质量良好
- 添加合适的提示词
- 正确设置语言参数

### Q4: 字幕分割过短
**症状**: 字幕切换频繁
**解决**:
- 使用SRT优化器
- 调整优化参数
- 检查音频质量

### Q5: GPU加速不工作
**症状**: 仍在使用CPU计算
**解决**:
- 安装CUDA和cuDNN
- 安装GPU版本的依赖
- 检查GPU兼容性

## 🌟 最佳实践

1. **预处理音频**: 确保音频清晰，背景噪音最小
2. **选择合适模型**: 根据需求平衡速度和质量
3. **设置正确语言**: 明确指定音频语言
4. **添加提示词**: 根据内容类型添加上下文提示
5. **后期优化**: 始终使用SRT优化器改善输出
6. **质量检查**: 在实际播放器中测试字幕效果

## 📞 技术支持

如遇到问题，请检查：
1. Python环境和依赖是否正确安装
2. 音频文件是否存在且格式正确
3. 网络连接是否正常（首次下载模型）
4. 磁盘空间是否充足

---

## 🎉 开始使用

现在你已经掌握了完整的音频转字幕工具链！

**快速测试**：
```bash
# 下载一个测试音频文件，然后运行：
python audio_to_srt.py test_audio.mp4 -l zh -m base
python srt_optimizer.py test_audio.srt -t
```

享受高质量的自动字幕生成体验！ 🚀 